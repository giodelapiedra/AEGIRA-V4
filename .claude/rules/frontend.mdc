---
description: AEGIRA Frontend Rules - React + TanStack Query + shadcn/ui
globs: ["aegira-frontend/**/*.{ts,tsx}"]
alwaysApply: false
---
# Frontend Rules

## Quick Reference

### API & State
- API calls: `apiClient` + `ENDPOINTS` constants (dynamic: `ENDPOINTS.PERSON.BY_ID(id)`)
- Query hooks: `useQuery` + `STALE_TIMES` (REALTIME 30s, STANDARD 2m, STATIC 10m, IMMUTABLE 30m)
- Mutations: `useMutation` + invalidate ALL affected query keys in `onSuccess`
- State: TanStack Query (server), Zustand (auth only), React Hook Form (forms)

### Components & Pages
- Pages: wrap in `<PageLoader isLoading error skeleton="type">` — never manual if/else
- Tables: `DataTable` from `@/components/ui/data-table` — never custom pagination
- Forms: React Hook Form + Zod (`zodResolver`) — never manual useState for form fields
- Columns: define OUTSIDE component (prevents re-renders)
- Schemas: define OUTSIDE component

### Data Access
- Page index: 0-indexed in frontend (`pageIndex`), 1-indexed in API (`page`)
- Safe access: always use `data?.items ?? []` (never `data.items`)
- Types: import from `@/types/`, re-export from hooks

### Mutation Pattern
```typescript
try {
  await mutation.mutateAsync(data);
  toast({ title: 'Success', description: '...' });
  navigate(ROUTES.LIST);
} catch (error) {
  toast({
    title: 'Error',
    description: error instanceof Error ? error.message : 'Failed',
    variant: 'destructive',
  });
}
```

### Query Invalidation
- Create: invalidate `['entities']`
- Update: invalidate `['entities']` AND `['entity', id]`
- Delete: invalidate `['entities']` AND related entities
